var products = [
    // Bento
    [
        {
            image: '../images/img-1-1.png',
            name: 'Cơm Cá Đỏ Sốt Teriyaki',
            price: '99,000'
        },
        {
            image: '../images/img-1-2.png',
            name: 'Cơm Bento Thịt Heo Chiên Xù Sốt Tonkatsu',
            price: '99,000'
        },
        {
            image: '../images/img-1-6.png',
            name: 'Cơm Cá Hồi Sốt Teriyaki',
            price: '159,000'
        },
        {
            image: '../images/img-1-7.png',
            name: 'Cơm Tôm Chiên Xù',
            price: '169,000'
        },
        {
            image: '../images/img-1-8.png',
            name: 'Cơm Hải Sản',
            price: '169,000'
        },
        {
            image: '../images/img-1-9.png',
            name: 'Cơm Lươn Nhật',
            price: '189,000'
        }
    ],
    // Sushi
    [
        {
            image: '../images/img-0-1.png',
            name: 'Tempura Roll',
            price: '118,000'
        },
        {
            image: '../images/img-0-2.png',
            name: 'Grilled Salmon Roll',
            price: '129,000'
        },
        {
            image: '../images/img-0-3.png',
            name: 'Kani Crunchy Roll',
            price: '153,000'
        },
        {
            image: '../images/img-0-4.png',
            name: 'Soft Shell Crab Roll',
            price: '168,000'
        },
        {
            image: '../images/img-0-5.png',
            name: 'Avocado Roll',
            price: '95,000'
        },
        {
            image: '../images/img-0-6.png',
            name: 'Tokachi Grilled Roll',
            price: '159,000'
        },
        {
            image: '../images/img-0-7.png',
            name: 'Unagi Roll',
            price: '280,000'
        },
        {
            image: '../images/img-0-8.png',
            name: 'Spicy Ebi Roll',
            price: '118,000'
        },
        {
            image: '../images/img-0-9.png',
            name: 'Cơm Cuộn Rồng Xanh',
            price: '79,000'
        },
        {
            image: '../images/img-0-10.png',
            name: 'Cơm Cuộn California',
            price: '139,000'
        },
        {
            image: '../images/img-0-11.png',
            name: 'Cơm Cuộn Cá Hồi Nướng Tái',
            price: '139,000'
        },
        {
            image: '../images/img-0-12.png',
            name: 'Cơm Cuộn Tôm Chiên Tempura',
            price: '179,000'
        },
        {
            image: '../images/img-0-13.png',
            name: 'Cơm Cuộn Cầu Vồng',
            price: '179,000'
        },
        {
            image: '../images/img-0-14.png',
            name: 'Cơm Cuộn Lươn Phô Mai',
            price: '199,000'
        },
        {
            image: '../images/img-0-15.png',
            name: 'Cơm Cuộn Hải Sản',
            price: '199,000'
        },
    ],
    // Sashimi
    [
        {
            image: '../images/img-2-1.png',
            name: 'Sashimi Ốc Bulot Ireland',
            price: '189,000'
        },
        {
            image: '../images/img-2-2.png',
            name: 'Sashimi Cá Chim Việt Nam',
            price: '199,000'
        },
        {
            image: '../images/img-2-3.png',
            name: 'Sashimi Cá Mú Việt Nam',
            price: '219,000'
        },
        {
            image: '../images/img-2-4.png',
            name: 'Sashimi Tôm Sú Việt Nam',
            price: '249,000'
        },
        {
            image: '../images/img-2-5.png',
            name: 'Sashimi Cá Bơn Hàn Quốc',
            price: '399,000'
        },
        {
            image: '../images/img-2-6.png',
            name: 'Sashimi Bào Ngư Hàn Quốc',
            price: '499,000'
        },
        {
            image: '../images/img-2-7.png',
            name: 'Sashimi Ốc Vòi Voi',
            price: '889,000'
        },
        {
            image: '../images/img-2-8.png',
            name: 'Sashimi Bạch Tuộc',
            price: '169,000'
        },
        {
            image: '../images/img-2-9.png',
            name: 'Sashimi Trứng Cá Hồi',
            price: '239,000'
        },
        {
            image: '../images/img-2-10.png',
            name: 'Sashimi Bụng Cá Cam',
            price: '299,000'
        },
        {
            image: '../images/img-2-11.png',
            name: 'Sashimi Bụng Cá Hồi',
            price: '219,000'
        },
        {
            image: '../images/img-2-12.png',
            name: 'Sashimi Cá Trích Ép Trứng Đỏ',
            price: '169,000'
        },
        {
            image: '../images/img-2-13.png',
            name: 'Sashimi Cá Trích Ép Trứng Vàng',
            price: '169,000'
        },
        {
            image: '../images/img-2-14.png',
            name: 'Sashimi Cồi Sò Điệp Nhật',
            price: '239,000'
        },
        {
            image: '../images/img-2-15.png',
            name: 'Sashimi Sò Đỏ Hokkigai',
            price: '239,000'
        },
        {
            image: '../images/img-2-16.png',
            name: 'Sashimi Trứng Cá Chuồn',
            price: '169,000'
        },
        {
            image: '../images/img-2-17.png',
            name: 'Sashimi Thân Cá Hồi',
            price: '199,000'
        },
        {
            image: '../images/img-2-2.png',
            name: 'Sashimi Cá Chim Việt Nam',
            price: '199,000'
        },
        {
            image: '../images/img-2-4.png',
            name: 'Sashimi Tôm Sú Việt Nam',
            price: '249,000'
        },
        {
            image: '../images/img-2-6.png',
            name: 'Sashimi Bào Ngư Hàn Quốc',
            price: '499,000'
        },
        {
            image: '../images/img-2-8.png',
            name: 'Sashimi Bạch Tuộc',
            price: '169,000'
        },
        {
            image: '../images/img-2-10.png',
            name: 'Sashimi Bụng Cá Cam',
            price: '299,000'
        }
    ],
    // Combo Sashimi
    [
        {
            image: '../images/img-3-1.png',
            name: 'Combo Sashimi 3A',
            price: '269,000'
        },
        {
            image: '../images/img-3-2.png',
            name: 'Combo Sashimi 3B',
            price: '289,000'
        },
        {
            image: '../images/img-3-3.png',
            name: 'Combo Sashimi 3C',
            price: '319,000'
        },
        {
            image: '../images/img-3-4.png',
            name: 'Combo Sashimi 3D',
            price: '349,000'
        },
        {
            image: '../images/img-3-5.png',
            name: 'Combo Sashimi 3E',
            price: '389,000'
        },
        {
            image: '../images/img-3-6.png',
            name: 'Combo Sashimi 3F',
            price: '598,000'
        },
        {
            image: '../images/img-3-7.png',
            name: 'Combo Sashimi 5A',
            price: '499,000'
        },
        {
            image: '../images/img-3-8.png',
            name: 'Combo Sashimi 5B',
            price: '549,000'
        },
        {
            image: '../images/img-3-9.png',
            name: 'Combo Sashimi 5C',
            price: '849,000'
        },
        {
            image: '../images/img-3-10.png',
            name: 'Combo Sashimi 5D',
            price: '749,000'
        },
        {
            image: '../images/img-3-11.png',
            name: 'Combo Sashimi 7A',
            price: '999,000'
        },
        {
            image: '../images/img-3-12.png',
            name: 'Combo Sashimi 7B',
            price: '999,000'
        },
        {
            image: '../images/img-3-13.png',
            name: 'Combo Sashimi 7C',
            price: '990,000'
        },
        {
            image: '../images/img-3-14.png',
            name: 'Combo Sashimi Hoàng Gia',
            price: '2,249,000'
        } 
    ],
    // Món ăn kèm
    [
        {
            image: '../images/img-4-1.png',
            name: 'Bánh Xèo Nhật',
            price: '89,000'
        },
        {
            image: '../images/img-4-2.png',
            name: 'Cá Hồi Sốt Teriyaki',
            price: '99,000'
        },
        {
            image: '../images/img-4-3.png',
            name: 'Đậu Nành Nhật',
            price: '35,000'
        },
        {
            image: '../images/img-4-4.png',
            name: 'Gừng Hồng',
            price: '10,000'
        },
        {
            image: '../images/img-4-5.png',
            name: 'Lá Tía Tô',
            price: '10,000'
        },
        {
            image: '../images/img-4-6.png',
            name: 'Lẩu Hải Sản Cay',
            price: '399,000'
        },
        {
            image: '../images/img-4-7.png',
            name: 'Mì Udon Hải Sản Cay',
            price: '199,000'
        },
        {
            image: '../images/img-4-8.png',
            name: 'Rong Nho',
            price: '99,000'
        },
        {
            image: '../images/img-4-9.png',
            name: 'Salad Cá Hồi Da Giòn',
            price: '119,000'
        },
        {
            image: '../images/img-4-10.png',
            name: 'Salad Hải Sản Sốt Hành Tây',
            price: '169,000'
        },
        {
            image: '../images/img-4-11.png',
            name: 'Salad Wakame',
            price: '69,000'
        },
        {
            image: '../images/img-4-12.png',
            name: 'Soup Miso Đầu Cá Bơn',
            price: '79,000'
        },
        {
            image: '../images/img-4-13.png',
            name: 'Soup Miso Đầu Cá Chim',
            price: '79,000'
        },
        {
            image: '../images/img-4-14.png',
            name: 'Soup Miso Đầu Cá Hồi',
            price: '79,000'
        },
        {
            image: '../images/img-4-15.png',
            name: 'Wasabi Tươi',
            price: '10,000'
        }
    ],
    // Nước uống và tráng miệng
    [
        {
            image: '../images/img-5-1.png',
            name: 'Coca-Cola',
            price: '10,000'
        },
        {
            image: '../images/img-5-2.png',
            name: 'Nước Suối Dasani',
            price: '10,000'
        },
        {
            image: '../images/img-5-3.png',
            name: 'Tàu Hủ Tươi Sentofu - Vị Đào',
            price: '19,000'
        },
        {
            image: '../images/img-5-4.png',
            name: 'Tàu Hủ Tươi Sentofu - Vị Dâu',
            price: '19,000'
        },
        {
            image: '../images/img-5-5.png',
            name: 'Tàu Hủ Tươi Sentofu - Vị Lá Dứa',
            price: '19,000'
        },
        {
            image: '../images/img-5-6.png',
            name: 'Tàu Hủ Tươi Sentofu - Vị Truyền Thống',
            price: '19,000'
        },
        {
            image: '../images/img-5-7.png',
            name: 'Tàu Hủ Tươi Sentofu - Vị Việt Quất',
            price: '19,000'
        },
    ]
]

const Products = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;

if(Products === products) {
    localStorage.setItem("product", JSON.stringify(Products))
}

const sectionItems = document.querySelectorAll('.section__header-menu li');
const productList = document.querySelector('.section__content-list');
const pagi = document.getElementById('pagination');
const scrollToTop = document.getElementById('scroll-to-top');

const pageNum = document.querySelector('.pagi-number-page');

const sectionContents = document.querySelectorAll('.section__content');

// ** Xử lý thay đổi URL trên sidebar
const sidebarItems = document.querySelectorAll('.sidebar__menu-item');
function sidebarControl() {
    sidebarItems.forEach(function(sidebarItem, index) {
        sidebarItem.onclick = function() {
            document.querySelector('.sidebar__menu-item.active').classList.remove('active');
            sidebarItem.classList.add('active');

            sectionContents.forEach(function(sectionContent) {
                sectionContent.style.display = 'none';
            })

            switch(index) {
                case 0:
                    document.querySelector('.section__content.home').style.display = "block";
                    break;
                case 1:
                    document.querySelector('.section__content.food').style.display = "block";
                    break;
                case 2:
                    document.querySelector('.section__content.checkout').style.display = "block";
                    break;
                case 3:
                    document.querySelector('.section__contact.section__contact').style.display = "flex";
                    break;
                case 4:
                    window.location.pathname = '/html/settings.html';
                    break;
            }
        }
    })
    renderProduct(Products[0]);
}

// ** Xử lý render sản phẩm ra màn hình
function renderProduct(items) {
    const htmls = items.map((item, index) => {
        if(index >= start1 && index < end) {
            return `
                <li class="section__content-item">
                    <div class="section__content-item-img" style="background-image: url('${item.image}');"></div>
                    <div class="section__content-item-text">
                        <h3>${item.name}</h3>
                        <p>${item.price} ₫</p>
                    </div>
                    <i class="eye-icon ti-eye" style="display: none;"></i>
                </li>`
        }
    });

    productList.innerHTML = htmls.join('');
}

// ** Xử lý di chuột qua các sản phẩm trong danh sách
const overlay = document.querySelector('.overlay.detail');
const modal = document.querySelector('.modal');

function productHandle(k) {
    var productItems = document.querySelectorAll('.section__content-item');
    var sectionImages = document.querySelectorAll('.section__content-item-img');
    var closeDetail = document.querySelector('.modal > i.close-icon');

    var details = document.querySelectorAll('.eye-icon');
    
    productItems.forEach((item, index) => {
        sectionImages[index].style.transition = 'all linear 0.3s'; // cho các hành động mượt hơn
        item.onmouseover = function() {
            sectionImages[index].style.backgroundSize = '110%'; // Zoom to nhỏ hình ảnh sản phẩm
            details[index].style.display = 'block'; // Ẩn hiện con mắt
        }
        item.onmouseout = function() {
            sectionImages[index].style.backgroundSize = '100%';
            details[index].style.display = 'none';
        }

        details[index].onclick = function() {
            document.querySelector('.modal__inner-img').style.backgroundImage = `url(${Products[k][index + perPage*(curPage-1)].image})`;
            document.querySelector('.modal__inner-heading').innerText = Products[k][index + perPage*(curPage-1)].name;
            document.querySelector('.modal__inner-price').innerText = Products[k][index + perPage*(curPage-1)].price;
            overlay.classList.add('open');
        }

        overlay.onclick = function() {
            quantity.value = 1;
            overlay.classList.remove('open');
        }

        closeDetail.onclick = function() {
            quantity.value = 1;
            overlay.classList.remove('open');
        }

        modal.onclick = function(e) {
            e.stopPropagation();
        }
    })
}

// Điều khiển nút bấm trên Section
function sectionControl(list) {
    list.forEach((item, index) => {
        item.onclick = function() {

            pageDefault();

            document.querySelector('.section__header-menu li.active').classList.remove('active')
            item.classList.add('active')
            
            renderProduct(Products[index]);
            productHandle(index);

            if(Products[index].length > 8) {
                pagi.style.display = "flex";
                PagiHandle(index, Products[index]);
                renderNumPage();
            }
            else {
                pagi.style.display = "none";
            }
            changeNumPage(index, Products[index]);
        }
    })
    
}

// ** Xử lý phân trang
var perPage = 8; // Số sản phẩm tối đa trong 1 trang
var curPage = 1; // Trang hiện tại 
var start1 = 0; // index sản phẩm đầu
var end = perPage; // index sản phẩm cuối
var totalPage;

const btnNext = document.querySelector('.btn-next');
const btnPrev = document.querySelector('.btn-prev');
// Lấy ra trang hiện tại
function getCurrentPage(curPage) {
    start1 = (curPage - 1) * perPage;
    end = curPage * perPage;
}

function PagiHandle(index, list) {
    totalPage = Math.ceil(list.length / perPage); // Tổng số trang của 1 loại sp
    // Ấn next tới trang tiếp theo
    btnNext.onclick = function() {
        curPage++;
        if(curPage >= totalPage) {
            curPage = totalPage;
            btnNext.classList.remove('active');
            btnPrev.classList.add('active');
        }
        else {
            btnNext.classList.add('active');
            btnPrev.classList.add('active');
        }
        document.querySelector('.pagi-number-page li.active').classList.remove('active');
        document.querySelectorAll('.pagi-number-page li')[curPage - 1].classList.add('active');
        
        getCurrentPage(curPage);
        renderProduct(list);
        productHandle(index);
    }
    // Ấn prev tới trang trước đó
    btnPrev.onclick = function() {
        curPage--;
        if(curPage <= 1) {
            curPage = 1 ;
            btnNext.classList.add('active');
            btnPrev.classList.remove('active');
        }
        else {
            btnNext.classList.add('active');
            btnPrev.classList.add('active');
        }
        document.querySelector('.pagi-number-page li.active').classList.remove('active');
        document.querySelectorAll('.pagi-number-page li')[curPage - 1].classList.add('active');

        getCurrentPage(curPage);
        renderProduct(list);
        productHandle(index);
    }
}

// Xử lý hiện số trang ra màn hình
function renderNumPage() {
    var html = '';
    html += `<li class="active">${1}</li>`;

    for(let i=2; i <= totalPage; i++) {
        html += `
        <li>${i}</li>`;
    }
    pageNum.innerHTML = html;
}

// Xử lý thay đổi số trang
function changeNumPage(index, list) {
    var numPages = document.querySelectorAll('.pagi-number-page li');

    for(let i=0; i < numPages.length; i++) {
        numPages[i].onclick = function() {
            document.querySelector('.pagi-number-page li.active').classList.remove('active');
            numPages[i].classList.add('active');

            if(i == 0) {
                btnNext.classList.add('active');
                btnPrev.classList.remove('active');
            }
            else if(i == numPages.length - 1) {
                btnNext.classList.remove('active');
                btnPrev.classList.add('active');
            }
            else {
                btnNext.classList.add('active');
                btnPrev.classList.add('active');
            }

            let value = i + 1;
            curPage = value;
            getCurrentPage(curPage);
            renderProduct(list);
            productHandle(index);

        }
    }
}

// Trang mặc định ban đầu
function pageDefault() {
    getCurrentPage(1);
    curPage = 1;
    btnNext.classList.add('active');
    btnPrev.classList.remove('active');
}

// ** Xử lý ẩn/hiện form Đăng ký/Đăng nhập
const loginBtn = document.getElementById('section__header-login');
const overlayLogin = document.querySelector('.overlay.login');
const modalLogin = document.querySelector('.modal.login');
const closeLogin = document.querySelectorAll('.close-icon.login');
const signupBtn = document.querySelector('.wrapper__not-account span');
const formSignup = document.querySelector('.sign-up');
const formSignin = document.querySelector('.sign-in');
const loginBack = document.querySelector('.login-back-icon');

function openFormLogin() {
    loginBtn.onclick = function() {
        var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
        if(arr[0].isAdmin == false && arr[0].isUser == false) {
            formSignup.style.display = 'none';
            formSignin.style.display = 'block';
            overlayLogin.classList.add('open');
        }
    }
}

function closeFormLogin() {
    for(let i = 0; i < closeLogin.length; i++) {
        closeLogin[i].onclick = function() {
            overlayLogin.classList.remove('open');
        }
    }
    overlayLogin.onclick = function() {
        overlayLogin.classList.remove('open');
    }
    
    modalLogin.onclick = function(e) {
        e.stopPropagation();
    }
}

signupBtn.onclick = function() {
    formSignup.style.display = 'block';
    formSignin.style.display = 'none';
}

loginBack.onclick = function() {
    formSignup.style.display = 'none';
    formSignin.style.display = 'block';
}

openFormLogin();
closeFormLogin();

// ** Xử lý lưu dữ liệu trên form Đăng ký/Đăng nhập
const loginFullname = document.getElementById('fullname');
const loginUsername = document.getElementById('username');
const loginpassword = document.getElementById('password');
const loginAgainPassword = document.getElementById('again-password');
const overlayNotify = document.querySelector('.overlay-notify');

var accounts = [
    {
        isAdmin: false,
        isUser: false,
        isLogout: true
    },
    {
        Fullname: 'user',
        Username: 'user',
        Password: 'user'
    }
]

loginFullname.onblur = function() {
    var fullname = loginFullname.value;
    checkFullname(fullname, 2);
}

loginUsername.onblur = function() {
    var username = loginUsername.value;
    checkUsername(username, 3);
}

loginpassword.addEventListener('blur', function() {
    var password = loginpassword.value;
    checkPassword(password, 4);
})

loginAgainPassword.addEventListener('blur', function() {
    var againPassword = loginAgainPassword.value;
    var password = loginpassword.value;
    checkAgainPassword(password, againPassword, 5);
})


function addLogin() {
    var fullname = loginFullname.value;
    var username = loginUsername.value;
    var password = loginpassword.value;

    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    var User = {
        Fullname: fullname,
        Username: username,
        Password: password
    }
    arr.push(User);
    localStorage.setItem('account', JSON.stringify(arr));
    clear();
}

// ** Check lỗi Form
var isFullname = false;
var isUsername = false;
var isPassword = false;
var isAgainPassword = false;
var errorMessage = document.querySelectorAll('.error-message');

function checkFullname(fullname, index) {
    if(fullname === '' || fullname === null) {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Họ tên không được để trống`
        errorMessage[index].style.opacity = '1';
    }
    else if(fullname.length > 30) {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Họ tên từ 1-30 ký tự`
        errorMessage[index].style.opacity = '1';
    }
    else {
        isFullname = true;
        errorMessage[index].style.opacity = '0';
    }
}

function checkUsername(username, index) {
    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    for(let i=0; i < arr.length; i++) {
        if(username === '' || username === null) {
            errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                            Tên đăng nhập không được để trống`
            errorMessage[index].style.opacity = '1';
        }
        else if(username.length < 5) {
            errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                            Tên đăng nhập có ít nhất 5 ký tự`
            errorMessage[index].style.opacity = '1';
        }
        else if(arr[i].Username === username && index != 0) {
            errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                            Tên đăng nhập bị trùng, vui lòng nhập tên khác`
            errorMessage[index].style.opacity = '1';
        }
        else {
            isUsername = true;
            errorMessage[index].style.opacity = '0';
        }
    }
}

function checkPassword(password, index) {
    if(password === '' || password === null) {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Mật khẩu không được để trống`
        errorMessage[index].style.opacity = '1';
    }
    else if(password.length < 8 && password !== 'admin') {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Mật khẩu ít nhất có 8 ký tự`;
        errorMessage[index].style.opacity = '1';
    }
    else {
        isPassword = true;
        errorMessage[index].style.opacity = '0';
    }
}

function checkAgainPassword(password, againPassword, index) {
    if(againPassword === '' || againPassword === null) {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Mật khẩu không được để trống`
        errorMessage[index].style.opacity = '1';
    }
    else if(password !== againPassword) {
        errorMessage[index].innerHTML = `<i class="fa-solid fa-circle-exclamation"></i>
                                        Mật khẩu nhập lại không đúng`;
        errorMessage[index].style.opacity = '1';
    }
    else {
        isAgainPassword = true;
        errorMessage[index].style.opacity = '0';
    }
}

// Kiểm tra đăng nhập Người dùng bình thường
function checkSignin() {
    var Username = document.getElementById('Username').value;
    var Password = document.getElementById('Password').value;
    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    for(let i = 0; i < arr.length; i++) {
        if(arr[i].Username == Username && arr[i].Password == Password) {
            arr[1].Fullname = arr[i].Fullname;
            arr[1].Username = arr[i].Username;
            arr[1].Password = arr[i].Password;
            localStorage.setItem('account', JSON.stringify(arr));
            return true;
        }
    }

    return false;
}

// Kiểm tra đăng nhập Người dùng là Admin
function checkAdmin() {
    var Username = document.getElementById('Username').value;
    var Password = document.getElementById('Password').value;
    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    for(let i = 0; i < arr.length; i++) {
        if (Username == "admin" && Password == "admin") {
            return true;
        }
    }

    return false;
}

function clear() {
    loginFullname.value = "";
    loginUsername.value = "";
    loginpassword.value = "";
    loginAgainPassword.value = "";
}

document.getElementById('login-btn').onclick = function(e) {
    if(isFullname === true && isUsername === true && isPassword === true && isAgainPassword === true) {
        setTimeout(function() {
            addLogin();
            overlayNotify.style.transform = 'translateX(0)';
            overlayNotify.style.opacity = '1';
            overlayNotify.innerHTML = `<div class="login-notify success">
                                            <i class="fa-solid fa-circle-check"></i>
                                            Đăng ký thành công
                                        </div>`;
        }, 500)
        
        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(100%)';
            overlayNotify.style.opacity = '0';
            formSignup.style.display = 'none';
            formSignin.style.display = 'block';
        }, 2000)
    }
    else {
        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(0)';
            overlayNotify.style.opacity = '1';
            overlayNotify.innerHTML = `<div class="login-notify error">
                                        <i class="fa-solid fa-circle-xmark"></i>
                                        Đăng ký chưa hợp lệ!!
                                    </div>`;
        }, 500)

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(100%)';
            overlayNotify.style.opacity = '0';
        }, 2000)
    }
}

document.getElementById('Username').onblur = function() {
    var username = document.getElementById('Username').value;
    checkUsername(username, 0);
}

document.getElementById('Password').onblur = function() {
    var password = document.getElementById('Password').value;
    checkPassword(password, 1);
}

document.getElementById('Login-Btn').onclick = function() {
    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    if(checkAdmin()) {
        arr[0].isAdmin = true;
        arr[0].isUser = false;
        arr[0].isLogout = false;

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(0)';
            overlayNotify.style.opacity = '1';
            overlayNotify.innerHTML = `<div class="login-notify success">
                                        <i class="fa-solid fa-circle-check"></i>
                                        Đăng nhập thành công
                                    </div>`;
            checkAccount();
        }, 500)

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(100%)';
            overlayNotify.style.opacity = '0';
            overlayLogin.classList.remove('open');
        }, 2000)

    }
    else if(checkSignin()) {
        arr[0].isUser = true;
        arr[0].isAdmin = false;
        arr[0].isLogout = false;

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(0)';
            overlayNotify.style.opacity = '1';
            overlayNotify.innerHTML = `<div class="login-notify success">
                                        <i class="fa-solid fa-circle-check"></i>
                                        Đăng nhập thành công
                                    </div>`;
            checkSignin();                        
            checkAccount();
        }, 500)

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(100%)';
            overlayNotify.style.opacity = '0';
            overlayLogin.classList.remove('open');
        }, 2000)

    }
    else {
        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(0)';
            overlayNotify.style.opacity = '1';
            overlayNotify.innerHTML = `<div class="login-notify error">
                                        <i class="fa-solid fa-circle-xmark"></i>
                                        Đăng nhập thất bại!!
                                    </div>`;
        }, 500)

        setTimeout(function() {
            overlayNotify.style.transform = 'translateX(100%)';
            overlayNotify.style.opacity = '0';
            document.getElementById('Username').value = "";
            document.getElementById('Password').value = "";
        }, 2000)
    }

    localStorage.setItem('account',JSON.stringify(arr))
}

// Kiểm tra tài khoản đã có hay chưa
function checkAccount() {
    var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;

    if(arr[0].isAdmin == false && arr[0].isUser == false) {
        openFormLogin();
    }
    else {
        if(arr[0].isAdmin == true) {
            document.querySelector('.sidebar__menu-item:last-child').classList.remove('hide');
            document.querySelector('.section__header-title-text.login').innerText = 'Admin';
        }
        else if(arr[0].isUser == true) {
            document.querySelector('.section__header-title-text.login').innerText = arr[1].Fullname;
        }

        document.querySelector('.sidebar__log-out').classList.remove('hide');
    }

    localStorage.setItem('account',JSON.stringify(arr));
}

// Xử lý khi ấn vào nút Log out
const logout = document.querySelector('.sidebar__log-out');
const notify = document.querySelector('.notify'); 

function checkLogout() {
    logout.onclick = function() {
        var arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;

        arr[0].isLogout = true;
        arr[0].isAdmin = false;
        arr[0].isUser = false;

        setTimeout(function() {
            notify.style.transform = 'translateX(0)';
            notify.style.opacity = '1';
            notify.innerHTML = `<div class="inner-notify success">
                                    <i class="fa-solid fa-person-running"></i>
                                    Đăng xuất thành công
                                </div>`;
        }, 500)
        
        setTimeout(function() {
            notify.style.transform = 'translateX(100%)';
            notify.style.opacity = '0';
        }, 1500)

        document.querySelector('.section__header-title-text.login').innerHTML = 'Đăng nhập';
        document.querySelector('.sidebar__log-out').classList.add('hide');
        localStorage.setItem('account',JSON.stringify(arr));

        setTimeout(function() {
            window.location.pathname = "/html/index.html";
        }, 2000)
    }
}

checkLogout();

// ** Xử lý cuộn lên trang đầu
function scrollTopHandle() {
    window.onscroll = function() {
        // Kiểm tra vị trí hiện tại của con trỏ so với nội dung trang
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            //nếu lớn hơn 200px thì hiện button
            scrollToTop.style.display = "block";
        }
        else {
            //nếu nhỏ hơn 200px thì ẩn button
            scrollToTop.style.display = "none";
        }
    };
    //gán sự kiện click cho button
    scrollToTop.addEventListener("click", function(){
        //Nếu button được click thì nhảy về đầu trang
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    });
}

// ** Xử lý tăng giảm số lượng
const amountBtns = document.querySelectorAll(".modal__inner-amount input[type='button']");
var quantity = document.querySelector(".modal__inner-amount input[type='text']");

amountBtns.forEach((amountBtn, index) => {
    amountBtn.onclick = function() {
        if(index == 0) {
            if(quantity.value == 1) {
                quantity.value = 1;
            }
            else {
                quantity.value--;
            }
        }
        else {
            quantity.value++;
        }
    }
})

// ** Tìm kiếm sản phẩm
// Xóa sự kiện tìm kiếm


var deleteSearch = document.querySelector('.section__delete');
deleteSearch.addEventListener('click', function() {})
// var temp = document.getElementById('search');
// temp.addEventListener('click', searchProduct);

// Xử lý tìm kiếm
var sectionMenu = document.querySelector('.section__header-menu');
var sectionTitle = document.querySelector('.section__content-title');
var isFilter = false;

function searchProduct() {
    const x = document.getElementById('section__search').value;
    if (x != '') {
        sectionMenu.style.display = 'none';
        sectionTitle.style.display = 'none';
    } else {
        sectionMenu.style.display = 'flex';
        sectionTitle.style.display = 'flex';
    }
    const arrProducts = [];
    var inner = ``;
    var count = 0;
    if (x.length > 0) {
        deleteSearch.style.display = 'block';
    } else {
        deleteSearch.style.display = 'none';
    }
    for (let i = 0; i < Products.length; i++) {
        for (let j = 0; j < Products[i].length; j++) {
            if (Products[i][j].name.toLowerCase().includes(x) == true) {
                arrProducts.push(Products[i][j]);
                count++;
            }
        }
    }

    if (count == 0) {
        document.querySelector('.section__content-list').innerHTML = `<h1 class="search__notfound">
        <img src="../images/no-products-found.png" alt="">
        <p>Không tìm thấy sản phẩm nào</p></h1>`
    }
    else {
        for (let i = 0; i < arrProducts.length; i++) {
            inner += `
            <li class="section__content-item">
                <div class="section__content-item-img" style="background-image: url('${arrProducts[i].image}');"></div>
                <div class="section__content-item-text">
                    <h3>${arrProducts[i].name}</h3>
                    <p>${arrProducts[i].price}</p>
                </div>
                <i class="eye-icon ti-eye" style="display: none;"></i>
            </li>`
        }
        document.querySelector('.section__content-list').innerHTML = inner;
    }
}

document.getElementById('section__search').addEventListener('keydown', function(e) {
    if(e.key == 'Enter' || e.which == 13) {
        searchProduct();
    }
})

// Xử lý bộ lọc tìm kiếm
const filterBtn = document.getElementById('filter-btn');
filterBtn.addEventListener('click', function() {
    if(!isFilter) {
        isFilter = true;
        document.querySelector('.filter').style.display = "flex";
        document.querySelector('.filter').style.opacity = "1";
    }
    else {
        isFilter = false;
        document.querySelector('.filter').style.display = "none";
        document.querySelector('.filter').style.opacity = "0";
    }
})

if(!isFilter) {
    document.querySelector('.filter').style.display = "none";
    document.querySelector('.filter').style.opacity = "0";
}



const typeProduct = document.querySelectorAll('.filter__header-selectors li');

function typeProductHandle() {
    for(let i = 0; i < typeProduct.length; i++) {
        typeProduct[i].onclick = function() {
            var flag = -1;
            
            if(document.querySelector('.filter__header-selectors li.active') != null) {
                if(typeProduct[i].innerText === document.querySelector('.filter__header-selectors li.active').innerText) {
                    flag = i;
                }
                document.querySelector('.filter__header-selectors li.active').classList.remove('active');
            }
            
            typeProduct[i].classList.add('active');

            if(flag != -1)
                document.querySelector('.filter__header-selectors li.active').classList.remove('active');
        }
    }
}

typeProductHandle();

function filterHandle() {
    var nameProduct = document.getElementById('nameproduct').value.toLowerCase();
    var moneyMin = document.getElementById('moneymin').value;
    var moneyMax = document.getElementById('moneymax').value;
    moneyMin = parseInt(moneyMin);
    moneyMax = parseInt(moneyMax);
    var count = 0;
    var x = ``;

    const arrtemp1 = [];
    const arrtemp2 = [];
    const arrtemp3 = [];

    for (let i = 0; i < Products.length; i++) {
        for (let j = 0; j < Products[i].length; j++) {
            const typeProductActive = document.querySelector('.filter__header-selectors li.active');
            var index;
            if(typeProductActive != null && typeProduct[i].innerText === typeProductActive.innerText) {
                arrtemp1.push(Products[i][j]);
                index = i;
                count++;
            }

            if((nameProduct !== '' || nameProduct !== null) && Products[i][j].name.toLowerCase().includes(nameProduct)) {
                arrtemp2.push(Products[i][j]);
                count++
            }

            // var tmp = (Products[i][j].price.split(','));
            // var tmp2 = Products[i][j].price;
            // var money = '';
            // for(let k = 0; k < tmp.length; k++) {
            //     money += tmp[k];
            // }
            // money = parseInt(money);
            var temp = Products[i][j].price;
            var money = parseInt(Products[i][j].price.split(','));
            if(moneyMin !== NaN && moneyMax !== NaN && (money >= moneyMin && money <= moneyMax)) {
                Products[i][j].price = temp;
                arrtemp3.push(Products[i][j]);
                count++;
            }
        }
    }

    var arrtemp = [];

    if((arrtemp1.length > 0 && arrtemp2.length === 0 && arrtemp3.length === 0) || 
        (arrtemp2.length > 0 && arrtemp1.length === 0 && arrtemp3.length === 0) ||
        (arrtemp3.length > 0 && arrtemp1.length === 0 && arrtemp2.length === 0)) {
            arrtemp = [...arrtemp1, ...arrtemp2, ...arrtemp1];
    }
    else {
        if(arrtemp1.length > 0 && arrtemp2.length > 0 && arrtemp3.length > 0) {
            var test = [];
            var a = [];
            test = [...arrtemp1, ...arrtemp2].filter(function(item) {
                return test.includes(item) ? a.push(item) : test.push(item);
            })
        
            var test_2 = []
            test_2 = [...a, ...arrtemp3].filter(function(item) {
                return test_2.includes(item) ? arrtemp.push(item) : test_2.push(item);
            })
        }
        else {
            if(arrtemp1.length > 0 && arrtemp2.length > 0 && arrtemp3.length === 0) {
                var test = [];
                test = [...arrtemp1, ...arrtemp2].filter(function(item) {
                    return test.includes(item) ? arrtemp.push(item) : test.push(item);
                })
            }
            if(arrtemp1.length > 0 && arrtemp3.length > 0 && arrtemp2.length === 0) {
                var test = [];
                test = [...arrtemp1, ...arrtemp3].filter(function(item) {
                    return test.includes(item) ? arrtemp.push(item) : test.push(item);
                })
            }
            if(arrtemp2.length > 0 && arrtemp3.length > 0 && arrtemp1.length === 0) {
                var test = [];
                test = [...arrtemp2, ...arrtemp3].filter(function(item) {
                    return test.includes(item) ? arrtemp.push(item) : test.push(item);
                })                
            }
        }
    }
    

    if (count == 0 || (arrtemp1.length === 0 && arrtemp2.length === 0 && arrtemp3.length === 0)) {
        document.querySelector('.section__content-list').innerHTML = `<h1 class="search__notfound">
        <img src="../images/no-products-found.png" alt="">
        <p>Không tìm thấy sản phẩm nào</p></h1>`
    }
    else {
        pageDefault();
        renderProduct(arrtemp)
        productHandle(index);

        if(arrtemp.length > 8) {
            pagi.style.display = "flex";
            PagiHandle(index, arrtemp);
            renderNumPage();
        }
        else {
            pagi.style.display = "none";
        }
        changeNumPage(index, arrtemp);
    }
}

// ==> Gọi các hàm để thực hiện xử lý

sidebarControl();
sectionControl(sectionItems);
productHandle(0);
scrollTopHandle();
checkAccount();

